{"file":"C:\\Users\\USER\\Downloads\\Escrow MVP\\tests\\api\\deposits.test.ts","mappings":";;;;;AAAA,qDAA8C;AAC9C,+EAAyD;AACzD,mDAAoD;AAEpD,MAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,cAAc,IAAI,YAAY,CAAC;AAE1D,QAAQ,CAAC,oBAAoB,EAAE,GAAG,EAAE;IAClC,IAAI,CAAC,oCAAoC,EAAE,KAAK,IAAI,EAAE;QACpD,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAA,6BAAW,EAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC;QAC5E,MAAM,IAAA,eAAO,EAAC,GAAU,EAAE,GAAU,CAAC,CAAC;QACtC,MAAM,CAAC,GAAG,CAAC,cAAc,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACzC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;QAC1D,MAAM,OAAO,GAAG,EAAE,EAAE,EAAE,SAAS,EAAE,KAAK,EAAE,aAAa,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;QACvE,MAAM,MAAM,GAAG,MAAM,IAAA,qBAAW,EAAC,OAAO,EAAE,MAAM,CAAC,CAAC;QAClD,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAA,6BAAW,EAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,EAAE,OAAO,EAAE,EAAE,MAAM,EAAE,WAAW,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC;QACtH,MAAM,IAAA,eAAO,EAAC,GAAU,EAAE,GAAU,CAAC,CAAC;QACtC,MAAM,CAAC,CAAC,GAAG,EAAC,GAAG,CAAC,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,cAAc,EAAE,CAAC,CAAC;IACpD,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Users\\USER\\Downloads\\Escrow MVP\\tests\\api\\deposits.test.ts"],"sourcesContent":["import { createMocks } from 'node-mocks-http';\r\nimport handler from '../../src/pages/api/deposits/index';\r\nimport { signSession } from '../../src/lib/session';\r\n\r\nconst SECRET = process.env.SESSION_SECRET || 'dev-secret';\r\n\r\ndescribe('POST /api/deposits', () => {\r\n  test('returns 401 when no session cookie', async () => {\r\n    const { req, res } = createMocks({ method: 'POST', body: { amount: 100 } });\r\n    await handler(req as any, res as any);\r\n    expect(res._getStatusCode()).toBe(401);\r\n  });\r\n\r\n  test('creates deposit when authenticated buyer', async () => {\r\n    const payload = { id: 'buyer-1', email: 'buyer@local', role: 'buyer' };\r\n    const cookie = await signSession(payload, SECRET);\r\n    const { req, res } = createMocks({ method: 'POST', body: { amount: 123 }, headers: { cookie: `session=${cookie}` } });\r\n    await handler(req as any, res as any);\r\n    expect([200,201]).toContain(res._getStatusCode());\r\n  });\r\n});\r\n"],"version":3}