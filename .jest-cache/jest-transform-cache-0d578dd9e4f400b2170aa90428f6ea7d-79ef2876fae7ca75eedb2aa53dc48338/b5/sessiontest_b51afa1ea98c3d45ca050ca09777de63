57f7ba63cbbbddf82a823037400ea674
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const session_1 = require("../src/lib/session");
describe('session helpers', () => {
    const secret = 'test-secret';
    it('signs and verifies payload', async () => {
        const payload = { id: 'u1', role: 'ADMIN' };
        const signed = await (0, session_1.signSession)(payload, secret);
        expect(typeof signed).toBe('string');
        const parsed = await (0, session_1.verifySession)(signed, secret);
        expect(parsed).toEqual(payload);
    });
    it('rejects invalid signature', async () => {
        const payload = { id: 'u1', role: 'ADMIN' };
        const signed = await (0, session_1.signSession)(payload, secret);
        // Tamper
        const tampered = signed.replace('ADMIN', 'BUYER');
        const parsed = await (0, session_1.verifySession)(tampered, secret);
        expect(parsed).toBeNull();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVU0VSXFxEb3dubG9hZHNcXEVzY3JvdyBNVlBcXHRlc3RzXFxzZXNzaW9uLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSxnREFBZ0U7QUFFaEUsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQixNQUFNLE1BQU0sR0FBRyxhQUFhLENBQUM7SUFDN0IsRUFBRSxDQUFDLDRCQUE0QixFQUFFLEtBQUssSUFBSSxFQUFFO1FBQzFDLE1BQU0sT0FBTyxHQUFHLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUM7UUFDNUMsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLHFCQUFXLEVBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ2xELE1BQU0sQ0FBQyxPQUFPLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNyQyxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUEsdUJBQWEsRUFBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDbkQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNsQyxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxLQUFLLElBQUksRUFBRTtRQUN6QyxNQUFNLE9BQU8sR0FBRyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxDQUFDO1FBQzVDLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBQSxxQkFBVyxFQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNsRCxTQUFTO1FBQ1QsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDbEQsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLHVCQUFhLEVBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ3JELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUM1QixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcVVNFUlxcRG93bmxvYWRzXFxFc2Nyb3cgTVZQXFx0ZXN0c1xcc2Vzc2lvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNpZ25TZXNzaW9uLCB2ZXJpZnlTZXNzaW9uIH0gZnJvbSAnLi4vc3JjL2xpYi9zZXNzaW9uJztcclxuXHJcbmRlc2NyaWJlKCdzZXNzaW9uIGhlbHBlcnMnLCAoKSA9PiB7XHJcbiAgY29uc3Qgc2VjcmV0ID0gJ3Rlc3Qtc2VjcmV0JztcclxuICBpdCgnc2lnbnMgYW5kIHZlcmlmaWVzIHBheWxvYWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBwYXlsb2FkID0geyBpZDogJ3UxJywgcm9sZTogJ0FETUlOJyB9O1xyXG4gICAgY29uc3Qgc2lnbmVkID0gYXdhaXQgc2lnblNlc3Npb24ocGF5bG9hZCwgc2VjcmV0KTtcclxuICAgIGV4cGVjdCh0eXBlb2Ygc2lnbmVkKS50b0JlKCdzdHJpbmcnKTtcclxuICAgIGNvbnN0IHBhcnNlZCA9IGF3YWl0IHZlcmlmeVNlc3Npb24oc2lnbmVkLCBzZWNyZXQpO1xyXG4gICAgZXhwZWN0KHBhcnNlZCkudG9FcXVhbChwYXlsb2FkKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3JlamVjdHMgaW52YWxpZCBzaWduYXR1cmUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBwYXlsb2FkID0geyBpZDogJ3UxJywgcm9sZTogJ0FETUlOJyB9O1xyXG4gICAgY29uc3Qgc2lnbmVkID0gYXdhaXQgc2lnblNlc3Npb24ocGF5bG9hZCwgc2VjcmV0KTtcclxuICAgIC8vIFRhbXBlclxyXG4gICAgY29uc3QgdGFtcGVyZWQgPSBzaWduZWQucmVwbGFjZSgnQURNSU4nLCAnQlVZRVInKTtcclxuICAgIGNvbnN0IHBhcnNlZCA9IGF3YWl0IHZlcmlmeVNlc3Npb24odGFtcGVyZWQsIHNlY3JldCk7XHJcbiAgICBleHBlY3QocGFyc2VkKS50b0JlTnVsbCgpO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9