edaec1a1a51a7aefc810240fa919563a
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const node_mocks_http_1 = require("node-mocks-http");
const index_1 = __importDefault(require("../../src/pages/api/withdrawals/index"));
const session_1 = require("../../src/lib/session");
const SECRET = process.env.SESSION_SECRET || 'dev-secret';
describe('POST /api/withdrawals', () => {
    test('returns 401 when no session cookie', async () => {
        const { req, res } = (0, node_mocks_http_1.createMocks)({ method: 'POST', body: { amount: 100 } });
        await (0, index_1.default)(req, res);
        expect(res._getStatusCode()).toBe(401);
    });
    test('creates withdrawal when authenticated seller', async () => {
        const payload = { id: 'seller-1', email: 'seller@local', role: 'seller' };
        const cookie = await (0, session_1.signSession)(payload, SECRET);
        const { req, res } = (0, node_mocks_http_1.createMocks)({ method: 'POST', body: { amount: 123 }, headers: { cookie: `session=${cookie}` } });
        await (0, index_1.default)(req, res);
        expect([200, 201]).toContain(res._getStatusCode());
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVU0VSXFxEb3dubG9hZHNcXEVzY3JvdyBNVlBcXHRlc3RzXFxhcGlcXHdpdGhkcmF3YWxzLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxxREFBOEM7QUFDOUMsa0ZBQTREO0FBQzVELG1EQUFvRDtBQUVwRCxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsSUFBSSxZQUFZLENBQUM7QUFFMUQsUUFBUSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTtJQUNyQyxJQUFJLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDcEQsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFBLDZCQUFXLEVBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDNUUsTUFBTSxJQUFBLGVBQU8sRUFBQyxHQUFVLEVBQUUsR0FBVSxDQUFDLENBQUM7UUFDdEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN6QyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyw4Q0FBOEMsRUFBRSxLQUFLLElBQUksRUFBRTtRQUM5RCxNQUFNLE9BQU8sR0FBRyxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUM7UUFDMUUsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLHFCQUFXLEVBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ2xELE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBQSw2QkFBVyxFQUFDLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLFdBQVcsTUFBTSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDdEgsTUFBTSxJQUFBLGVBQU8sRUFBQyxHQUFVLEVBQUUsR0FBVSxDQUFDLENBQUM7UUFDdEMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDO0lBQ3BELENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVU0VSXFxEb3dubG9hZHNcXEVzY3JvdyBNVlBcXHRlc3RzXFxhcGlcXHdpdGhkcmF3YWxzLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlTW9ja3MgfSBmcm9tICdub2RlLW1vY2tzLWh0dHAnO1xyXG5pbXBvcnQgaGFuZGxlciBmcm9tICcuLi8uLi9zcmMvcGFnZXMvYXBpL3dpdGhkcmF3YWxzL2luZGV4JztcclxuaW1wb3J0IHsgc2lnblNlc3Npb24gfSBmcm9tICcuLi8uLi9zcmMvbGliL3Nlc3Npb24nO1xyXG5cclxuY29uc3QgU0VDUkVUID0gcHJvY2Vzcy5lbnYuU0VTU0lPTl9TRUNSRVQgfHwgJ2Rldi1zZWNyZXQnO1xyXG5cclxuZGVzY3JpYmUoJ1BPU1QgL2FwaS93aXRoZHJhd2FscycsICgpID0+IHtcclxuICB0ZXN0KCdyZXR1cm5zIDQwMSB3aGVuIG5vIHNlc3Npb24gY29va2llJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgeyByZXEsIHJlcyB9ID0gY3JlYXRlTW9ja3MoeyBtZXRob2Q6ICdQT1NUJywgYm9keTogeyBhbW91bnQ6IDEwMCB9IH0pO1xyXG4gICAgYXdhaXQgaGFuZGxlcihyZXEgYXMgYW55LCByZXMgYXMgYW55KTtcclxuICAgIGV4cGVjdChyZXMuX2dldFN0YXR1c0NvZGUoKSkudG9CZSg0MDEpO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KCdjcmVhdGVzIHdpdGhkcmF3YWwgd2hlbiBhdXRoZW50aWNhdGVkIHNlbGxlcicsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHBheWxvYWQgPSB7IGlkOiAnc2VsbGVyLTEnLCBlbWFpbDogJ3NlbGxlckBsb2NhbCcsIHJvbGU6ICdzZWxsZXInIH07XHJcbiAgICBjb25zdCBjb29raWUgPSBhd2FpdCBzaWduU2Vzc2lvbihwYXlsb2FkLCBTRUNSRVQpO1xyXG4gICAgY29uc3QgeyByZXEsIHJlcyB9ID0gY3JlYXRlTW9ja3MoeyBtZXRob2Q6ICdQT1NUJywgYm9keTogeyBhbW91bnQ6IDEyMyB9LCBoZWFkZXJzOiB7IGNvb2tpZTogYHNlc3Npb249JHtjb29raWV9YCB9IH0pO1xyXG4gICAgYXdhaXQgaGFuZGxlcihyZXEgYXMgYW55LCByZXMgYXMgYW55KTtcclxuICAgIGV4cGVjdChbMjAwLDIwMV0pLnRvQ29udGFpbihyZXMuX2dldFN0YXR1c0NvZGUoKSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=