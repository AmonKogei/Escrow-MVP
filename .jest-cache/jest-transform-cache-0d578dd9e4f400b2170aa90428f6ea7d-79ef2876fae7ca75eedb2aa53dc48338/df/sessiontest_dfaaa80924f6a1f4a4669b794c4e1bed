8df46c78e997d87480585e78ad04fbeb
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const session_1 = require("../src/lib/session");
describe('session helpers', () => {
    const secret = 'test-secret';
    it('signs and verifies payload', async () => {
        const payload = { id: 'u1', role: 'ADMIN' };
        const signed = await (0, session_1.signSession)(payload, secret);
        expect(typeof signed).toBe('string');
        const parsed = await (0, session_1.verifySession)(signed, secret);
        expect(parsed).toEqual(payload);
    });
    it('rejects invalid signature', async () => {
        const payload = { id: 'u1', role: 'ADMIN' };
        const signed = await (0, session_1.signSession)(payload, secret);
        // Tamper
        const tampered = signed.replace('ADMIN', 'BUYER');
        const parsed = await (0, session_1.verifySession)(tampered, secret);
        expect(parsed).toBeNull();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVU0VSXFxEb3dubG9hZHNcXEVzY3JvdyBNVlBcXHRlc3RzIChTaW1wbGlmaWVkIGZvciBicmV2aXR5KVxcc2Vzc2lvbi50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsZ0RBQWdFO0FBRWhFLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDL0IsTUFBTSxNQUFNLEdBQUcsYUFBYSxDQUFDO0lBQzdCLEVBQUUsQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLElBQUksRUFBRTtRQUMxQyxNQUFNLE9BQU8sR0FBRyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxDQUFDO1FBQzVDLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBQSxxQkFBVyxFQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNsRCxNQUFNLENBQUMsT0FBTyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDckMsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLHVCQUFhLEVBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ25ELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDbEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsMkJBQTJCLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDekMsTUFBTSxPQUFPLEdBQUcsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsQ0FBQztRQUM1QyxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUEscUJBQVcsRUFBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDbEQsU0FBUztRQUNULE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ2xELE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBQSx1QkFBYSxFQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNyRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDNUIsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXFVTRVJcXERvd25sb2Fkc1xcRXNjcm93IE1WUFxcdGVzdHMgKFNpbXBsaWZpZWQgZm9yIGJyZXZpdHkpXFxzZXNzaW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2lnblNlc3Npb24sIHZlcmlmeVNlc3Npb24gfSBmcm9tICcuLi9zcmMvbGliL3Nlc3Npb24nO1xyXG5cclxuZGVzY3JpYmUoJ3Nlc3Npb24gaGVscGVycycsICgpID0+IHtcclxuICBjb25zdCBzZWNyZXQgPSAndGVzdC1zZWNyZXQnO1xyXG4gIGl0KCdzaWducyBhbmQgdmVyaWZpZXMgcGF5bG9hZCcsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHBheWxvYWQgPSB7IGlkOiAndTEnLCByb2xlOiAnQURNSU4nIH07XHJcbiAgICBjb25zdCBzaWduZWQgPSBhd2FpdCBzaWduU2Vzc2lvbihwYXlsb2FkLCBzZWNyZXQpO1xyXG4gICAgZXhwZWN0KHR5cGVvZiBzaWduZWQpLnRvQmUoJ3N0cmluZycpO1xyXG4gICAgY29uc3QgcGFyc2VkID0gYXdhaXQgdmVyaWZ5U2Vzc2lvbihzaWduZWQsIHNlY3JldCk7XHJcbiAgICBleHBlY3QocGFyc2VkKS50b0VxdWFsKHBheWxvYWQpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgncmVqZWN0cyBpbnZhbGlkIHNpZ25hdHVyZScsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHBheWxvYWQgPSB7IGlkOiAndTEnLCByb2xlOiAnQURNSU4nIH07XHJcbiAgICBjb25zdCBzaWduZWQgPSBhd2FpdCBzaWduU2Vzc2lvbihwYXlsb2FkLCBzZWNyZXQpO1xyXG4gICAgLy8gVGFtcGVyXHJcbiAgICBjb25zdCB0YW1wZXJlZCA9IHNpZ25lZC5yZXBsYWNlKCdBRE1JTicsICdCVVlFUicpO1xyXG4gICAgY29uc3QgcGFyc2VkID0gYXdhaXQgdmVyaWZ5U2Vzc2lvbih0YW1wZXJlZCwgc2VjcmV0KTtcclxuICAgIGV4cGVjdChwYXJzZWQpLnRvQmVOdWxsKCk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=